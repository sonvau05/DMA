<!doctype html>
<html>
<head><meta charset="utf-8"><title>Admin</title></head>
<body>
<nav>
  <ul>
    <li>Admin
      <ul>
        <li><a href="#" id="createArticle">Create Article</a></li>
        <li><a href="#" id="showArticle">Show Article</a></li>
      </ul>
    </li>
    <li>Manager
      <ul>
        <li><a href="#" id="createProduct">Create Product</a></li>
        <li><a href="#" id="showProduct">Show Product</a></li>
      </ul>
    </li>
    <li>Staff
      <ul>
        <li><a href="#" id="createEmployee">Create Employee</a></li>
        <li><a href="#" id="showEmployee">Show Employee</a></li>
      </ul>
    </li>
  </ul>
</nav>
<main id="app">Kiểm tra quyền...</main>
<script>
const apiProtected = '/api/data/protected';
async function callProtected(){
  let token = localStorage.getItem('access');
  const exp = parseInt(localStorage.getItem('exp')||'0')*1000;
  if(Date.now()>=exp){
    const rt = localStorage.getItem('refresh');
    const r = await fetch('/api/auth/refresh',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({refreshToken:rt})});
    if(r.ok){
      const j=await r.json();
      localStorage.setItem('access',j.accessToken);
      localStorage.setItem('refresh',j.refreshToken);
      localStorage.setItem('exp',j.expiresAt);
      token = j.accessToken;
    }else{location.href='/login.html';return}
  }
  const res = await fetch(apiProtected,{headers:{'Authorization':'Bearer '+token}});
  if(res.ok){document.getElementById('app').innerText='Đã vào trang quản trị'}else{location.href='/login.html'}
}
callProtected();
</script>
</body>
</html>
