<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin</title>
</head>
<body>
  <h2>Admin - User Tokens</h2>
  <input id="adminkey" placeholder="admin key">
  <button id="load">Load users</button>
  <table id="tbl"></table>
  <script>
    async function load() {
      const k = document.getElementById('adminkey').value;
      const r = await fetch('/api/admin/users?key=' + encodeURIComponent(k));
      if (!r.ok) { alert('Unauthorized'); return; }
      const users = await r.json();
      const tbl = document.getElementById('tbl');
      tbl.innerHTML = '';
      users.forEach(u => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${u.username}</td><td>${u.token || ''}</td><td>${u.tokenCleared}</td><td><button data-user="${u.username}">Clear token</button></td>`;
        tbl.appendChild(tr);
      });
      tbl.querySelectorAll('button').forEach(b => b.onclick = async e => {
        const user = e.target.dataset.user;
        const r = await fetch('/api/admin/clear/' + encodeURIComponent(user) + '?key=' + encodeURIComponent(k), { method: 'POST' });
        if (r.ok) load(); else alert('Failed');
      });
    }
    document.getElementById('load').onclick = load;
  </script>
</body>
</html>
